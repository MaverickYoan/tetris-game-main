{% extends "base.html" %}

{% block title %}Tetris - Accueil{% endblock %}

{% block content %}
<div class="card">
    <div class="text-center">
        <h2>Bienvenue dans l'expérience ultime de Tetris</h2>
        <p style="font-size: 18px; color: #677068ff; margin: 20px 0;">
            Mettez-vous au défi avec le jeu de puzzle classique qui ne vieillit jamais !
        </p>
    </div>
    
    {% if not session.username %}
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-top: 40px;">
        <div>
            <h3>Fonctionnalités du jeu</h3>
            <ul style="list-style: none; padding: 0; margin-top: 15px;">
                <li style="padding: 8px 0; border-bottom: 1px solid #eee;">Gameplay classique de Tetris</li>
                <li style="padding: 8px 0; border-bottom: 1px solid #eee;">Classements mondiaux</li>
                <li style="padding: 8px 0; border-bottom: 1px solid #eee;">Suivi des statistiques personnelles</li>
                <li style="padding: 8px 0; border-bottom: 1px solid #eee;">Sauvegarde de votre progression</li>
                <li style="padding: 8px 0; border-bottom: 1px solid #eee;">Design responsive</li>
                <li style="padding: 8px 0;">Niveaux de difficulté multiples</li>
            </ul>
        </div>
        
        <div>
            <h3>Commencer</h3>
            <p style="margin: 15px 0 25px 0; color: #5c705fff;">
                Prêt à tester vos compétences en résolution de puzzles ? Créez un compte pour commencer à jouer et rivaliser avec des joueurs du monde entier !
            </p>
            <div style="text-align: center;">
                <a href="/register" class="btn" style="margin-right: 10px;">Créer un compte</a>
                <a href="/login" class="btn btn-secondary">Se connecter</a>
            </div>
        </div>
    </div>
    {% else %}
    <div style="text-align: center; margin-top: 40px;">
        <h3>Content de te revoir, {{ session.username }}</h3>
        <p style="margin: 20px 0; color: #697a6cff; font-size: 18px;">
            Prêt pour une autre partie de Tetris ? Voyons si tu peux battre ton meilleur score !
        </p>
        
        <div style="margin: 30px 0;">
            <a href="/game" class="btn" style="font-size: 20px; padding: 15px 30px;">Commencer à jouer</a>
        </div>
        
        <div id="user-stats" style="margin-top: 40px;"></div>
    </div>
    
    <script>
        // Load user statistics
        fetch('/api/user/stats')
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    const stats = data.stats;
                    const statsContainer = document.getElementById('user-stats');
                    
                    const hours = Math.floor(stats.total_time_played / 3600);
                    const minutes = Math.floor((stats.total_time_played % 3600) / 60);
                    
                    statsContainer.innerHTML = `
                        <h3>Vos statistiques</h3>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-top: 20px;">
                            <div style="background: #f8f9fa; padding: 15px; border-radius: 10px; text-align: center;">
                                <div style="font-size: 24px; font-weight: bold; color: #4CAF50;">${stats.best_score.toLocaleString()}</div>
                                <div style="color: #697a6cff;">Meilleur score</div>
                            </div>
                            <div style="background: #f8f9fa; padding: 15px; border-radius: 10px; text-align: center;">
                                <div style="font-size: 24px; font-weight: bold; color: #2196F3;">${stats.total_games_played}</div>
                                <div style="color: #697a6cff;">Jeux joués</div>
                            </div>
                            <div style="background: #f8f9fa; padding: 15px; border-radius: 10px; text-align: center;">
                                <div style="font-size: 24px; font-weight: bold; color: #FF9800;">${stats.total_lines_cleared}</div>
                                <div style="color: #697a6cff;">Lignes effacées</div>
                            </div>
                            <div style="background: #f8f9fa; padding: 15px; border-radius: 10px; text-align: center;">
                                <div style="font-size: 24px; font-weight: bold; color: #9C27B0;">${hours}h ${minutes}m</div>
                                <div style="color: #697a6cff;">Temps joué</div>
                            </div>
                        </div>
                    `;
                }
            })
            .catch(error => {
                console.error('Failed to load user stats:', error);
            });
    </script>
    {% endif %}
</div>

<div class="card">
    <h3>Comment jouer</h3>
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-top: 20px;">
        <div>
            <h4>Contrôles :</h4>
            <ul style="margin-top: 10px;">
                <li><strong>←/→ Flèches :</strong> Déplacer la pièce à gauche/droite</li>
                <li><strong>↓ Flèche bas :</strong> Descente rapide</li>
                <li><strong>↑ Flèche haut :</strong> Rotation de la pièce</li>
                <li><strong>Barre d'espace :</strong> Descente immédiate</li>
            </ul>
        </div>
        <div>
            <h4>Scores :</h4>
            <ul style="margin-top: 10px;">
                <li><strong>Ligne simple :</strong> 100 × Niveau</li>
                <li><strong>Double lignes :</strong> 300 × Niveau</li>
                <li><strong>Triple lignes :</strong> 500 × Niveau</li>
                <li><strong>Tetris (4 lignes) :</strong> 800 × Niveau</li>
            </ul>
        </div>
    </div>
</div>

<div class="card">
    <h3>Top scores récents</h3>
    <div id="recent-scores" style="margin-top: 20px;">
        <p>Chargement de classement...</p>
    </div>
    
    <script>
        // Load recent top scores
        fetch('/api/leaderboard')
            .then(response => response.json())
            .then(data => {
                if (data.success && data.scores.length > 0) {
                    const scoresContainer = document.getElementById('recent-scores');
                    let html = '<table style="width: 100%; border-collapse: collapse;">';
                    html += '<tr style="background: #f0f0f0;"><th style="padding: 10px; border: 1px solid #ddd;">Rang</th><th style="padding: 10px; border: 1px solid #ddd;">Joueurs</th><th style="padding: 10px; border: 1px solid #ddd;">Score</th><th style="padding: 10px; border: 1px solid #ddd;">Lignes</th><th style="padding: 10px; border: 1px solid #ddd;">Niveau</th></tr>';

                    data.scores.slice(0, 5).forEach((score, index) => {
                        html += `<tr><td style="padding: 10px; border: 1px solid #ddd; text-align: center;">${index + 1}</td><td style="padding: 10px; border: 1px solid #ddd;">${score.username}</td><td style="padding: 10px; border: 1px solid #ddd; text-align: right;">${score.score.toLocaleString()}</td><td style="padding: 10px; border: 1px solid #ddd; text-align: center;">${score.lines_cleared}</td><td style="padding: 10px; border: 1px solid #ddd; text-align: center;">${score.level_reached}</td></tr>`;
                    });
                    
                    html += '</table>';
                    html += '<div style="text-align: center; margin-top: 15px;"><a href="#" onclick="showLeaderboard()" style="color: #667eea; text-decoration: none;">Voir le classement complet →</a></div>';
                    scoresContainer.innerHTML = html;
                } else {
                    document.getElementById('recent-scores').innerHTML = '<p style="text-align: center; color: #666;">Pas encore de scores.Être le premier à jouer.</p>';
                }
            })
            .catch(error => {
                document.getElementById('recent-scores').innerHTML = '<p style="color: #f44336;">Échec du chargement.</p>';
            });
    </script>
</div>
{% endblock %}
